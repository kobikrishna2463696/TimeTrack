<div class="dashboard-wrapper">
    <header class="main-header">
        <div class="brand">
            <div class="logo-box">ðŸ•’</div>
            <div class="header-text">
                <h1>TimeTrack</h1>
                <span>Employee Dashboard</span>
            </div>
        </div>
        <div class="user-meta">
            <div class="user-info">
                <strong>{{ authService.currentUser()?.name }}</strong>
                <p>{{ authService.currentUser()?.department || 'Engineering' }}</p>
            </div>
            <button class="logout-link" (click)="logout()">â†ª Logout</button>
        </div>
    </header>

    <nav class="tabs">
        <button [class.active]="activeTab() === 'logging'" (click)="setTab('logging')">ðŸ•’ Time Logging</button>
        <button [class.active]="activeTab() === 'tasks'" (click)="setTab('tasks')">ðŸ“‹ My Tasks</button>
        <button [class.active]="activeTab() === 'productivity'" (click)="setTab('productivity')">ðŸ“ˆ
            Productivity</button>
        <button [class.active]="activeTab() === 'notifications'" (click)="setTab('notifications')" class="notif-tab">
            ðŸ”” Notifications <span class="badge" *ngIf="unreadCount() > 0">{{unreadCount()}}</span>
        </button>
    </nav>

    <div [ngSwitch]="activeTab()" class="tab-content">
        <div *ngSwitchCase="'logging'">
            <div class="stats-row">
                <div class="card">
                    <h3>Today's Hours</h3>
                    <p>0 hrs</p>
                </div>
                <div class="card">
                    <h3>This Week</h3>
                    <p>{{weeklyHours()}} hrs</p>
                </div>
                <div class="card">
                    <h3>Days Logged</h3>
                    <p>{{timeLogs().length}} days</p>
                </div>
            </div>
            <div class="card table-card">
                <div class="header-row">
                    <h3>Time Logs</h3>
                    <button class="btn-primary" (click)="showModal.set(true)">+ Log Time</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Start</th>
                            <th>End</th>
                            <th>Break</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let log of timeLogs()">
                            <td>{{log.date}}</td>
                            <td>{{log.start}}</td>
                            <td>{{log.end}}</td>
                            <td>{{log.break}}m</td>
                            <td><strong>{{log.total}} hrs</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div *ngSwitchCase="'tasks'">
            <div class="task-list">
                <div *ngFor="let task of detailedTasks()" class="task-card card">
                    <div class="task-row">
                        <strong>{{task.title}}</strong>
                        <span class="pill" [attr.data-status]="task.status">{{task.status}}</span>
                    </div>
                    <div class="progress-info">
                        <div class="labels"><span>Progress</span><span>{{task.currentHours}}/{{task.totalHours}}
                                hrs</span></div>
                        <div class="progress-bg">
                            <div class="progress-fill" [style.width.%]="task.progress"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div *ngSwitchCase="'productivity'">
            <div class="charts-grid">
                <div class="card chart-box">
                    <h3>Daily Hours</h3><canvas #hoursChart></canvas>
                </div>
                <div class="card chart-box">
                    <h3>Status Distribution</h3><canvas #statusChart></canvas>
                </div>
            </div>
        </div>

        <div *ngSwitchCase="'notifications'">
            <div class="notifications-container">
                <div class="header-row">
                    <div class="title-group">
                        <h3>Notifications</h3>
                        <span class="sub-text">{{ unreadCount() }} unread notifications</span>
                    </div>
                    <button class="text-btn" (click)="markAllAsRead()">Mark all as read</button>
                </div>

                <div class="notification-list">
                    <div *ngFor="let note of detailedNotifications()" class="note-card-modern"
                        [ngClass]="[note.type, note.read ? 'read-state' : '']">
                        <div class="note-icon-box">
                            <span *ngIf="note.type === 'assignment'">ðŸ“—</span>
                            <span *ngIf="note.type === 'deadline'">ðŸ””</span>
                            <span *ngIf="note.type === 'reminder'">ðŸ•’</span>
                        </div>
                        <div class="note-content">
                            <div class="note-main">
                                <strong>{{note.message}}</strong>
                                <span class="note-time">{{note.timestamp}}</span>
                            </div>
                        </div>
                        <div class="note-action">
                            <button class="check-icon" [class.checked]="note.read">âœ”</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" *ngIf="showModal()">
    <div class="modal-card">
        <div class="modal-header">
            <h2>TimeTrack System</h2>
            <p>Daily Work Logging</p>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Select Date</label>
                <input type="date" [(ngModel)]="newLog.date" class="form-control">
            </div>
            <div class="form-row">
                <div class="form-group"><label>Start Time</label><input type="time" [(ngModel)]="newLog.start"
                        class="form-control"></div>
                <div class="form-group"><label>End Time</label><input type="time" [(ngModel)]="newLog.end"
                        class="form-control"></div>
            </div>
            <div class="form-group"><label>Break Duration (Mins)</label><input type="number" [(ngModel)]="newLog.break"
                    class="form-control"></div>
            <div class="gap-display">Total Gap: <strong>{{ totalGap() }} Hours</strong></div>
            <button class="btn-save-navy" (click)="saveLog()">Save Daily Log</button>
            <button class="btn-cancel" (click)="showModal.set(false)">Cancel</button>
        </div>
    </div>
</div>